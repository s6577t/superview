;
var KeyCodes={Escape:27,Return:13}
;
;
(function($){Superview=function(){eventify(this).define("onResized","onMoved","onSubviewAdded","onSubviewRemoved","onAdded","onRemoved"),this.onResized().throttle(10),this.onMoved().throttle(10),extend(this).withObject({hasViewMixin:!0,_controller:null,_parent:null,_anchoring:null,_subviews:{},_vid:Superview.vidSpool++,_zElem:z.div().css({overflow:"hidden",display:"inline-block",position:"absolute",left:0,top:0})})},Superview.prototype={setController:function(a){this._controller=a;return this},getController:function(){return this._controller},vid:function(){return this._vid},elem:function(){return this._zElem.elem()},$:function(){return this._zElem},add:function(){var a=$.isArray(arguments[0])?arguments[0]:Array.toArray(arguments),b=this;a.forEach(function(a){b.$().append(a.elem()),b._subviews[a.vid()]=a,a._parent=b,b.onSubviewAdded().emit(a,b),a.onAdded().emit(a,b)});return this},addTo:function(a){if(!a||this._parent)return this.remove();a.add(this);return this},parent:function(){return this._parent},ancestors:function(){var a=[],b=this.parent();while(b)a.push(b),b=b.parent();return a},isRoot:function(){return!this.parent()},root:function(){var a=this;while(!a.isRoot())a=a.parent();return a},remove:function(){var a=this,b=null,c=!1;arguments.length>0&&(jQuery.isArray(arguments[0])?(b=arguments[0],c=!0):b=Array.toArray(arguments));if(c||b&&b.length>0){b.forEach(function(a){a.remove()});return a}this.$().remove();var d=this._parent;this._parent=null,this.onRemoved().emit(this,d||null),d&&(delete d._subviews[this.vid()],d.onSubviewRemoved().emit(this,d)),this.removeAll(),deventify(this);return this},removeAll:function(){return this.remove(this.subviews())},subviews:function(a){var b=Object.values(this._subviews);a&&b.copy().forEach(function(c){b=b.concat(c.subviews(a))});return b},borderMetrics:function(){var a=this,b=this.$(),c={top:parseFloat(b.css("borderTopWidth"),10)||0,right:parseFloat(b.css("borderRightWidth"),10)||0,bottom:parseFloat(b.css("borderBottomWidth"),10)||0,left:parseFloat(b.css("borderLeftWidth"),10)||0};c.width=c.right+c.left,c.height=c.top+c.bottom;return c},paddingMetrics:function(){var a=this,b=this.$(),c={top:parseFloat(b.css("paddingTop"),10)||0,right:parseFloat(b.css("paddingRight"),10)||0,bottom:parseFloat(b.css("paddingBottom"),10)||0,left:parseFloat(b.css("paddingLeft"),10)||0};c.width=c.right+c.left,c.height=c.top+c.bottom;return c},resize:function(a){var b=!1,c=this.$(),d=this.rect();Superview.Rect.hasWidth(a)&&a.width!=d.width&&(b=!0,d.width=a.width,c.css("width",d.width)),Superview.Rect.hasHeight(a)&&a.height!=d.height&&(b=!0,d.height=a.height,c.css("height",d.height)),b&&this.onResized().emit(this,this.rect(),this.outerRect());return this},outerResize:function(a){var b=this.$();Superview.Rect.hasWidth(a)&&(a.width=a.width-(this.paddingMetrics().width+this.borderMetrics().width)),Superview.Rect.hasHeight(a)&&(a.height=a.height-(this.paddingMetrics().height+this.borderMetrics().height));return this.resize(a)},moveTo:function(a){var b=!1,c=this.$(),d=this.rect(),e=this.paddingMetrics(),f=this.borderMetrics();!Superview.Rect.hasTop(a)&&Superview.Rect.hasBottom(a)&&(a.top=a.bottom-d.height),!Superview.Rect.hasLeft(a)&&Superview.Rect.hasRight(a)&&(a.left=a.right-d.width),Superview.Rect.hasTop(a)&&a.top!=d.top&&(b=!0,d.top=a.top-e.top-f.top,c.css("top",d.top)),typeof a.left=="number"&&a.left!=d.left&&(b=!0,d.left=a.left-e.left-f.left,c.css("left",d.left)),b&&this.onMoved().emit(this,this.rect(),this.outerRect());return this},outerMoveTo:function(a){var b=this.$(),c=this.paddingMetrics(),d=this.borderMetrics();Superview.Rect.hasTop(a)&&(a.top+=c.top+d.top),Superview.Rect.hasBottom(a)&&(a.bottom-=c.bottom+d.bottom),Superview.Rect.hasLeft(a)&&(a.left+=c.left+d.left),Superview.Rect.hasRight(a)&&(a.right-=c.right+d.right);return this.moveTo(a)},rect:function(){var a=this,b=this.$(),c={left:parseFloat(b.css("left"),10),top:parseFloat(b.css("top"),10)},d={top:c.top+a.paddingMetrics().top+a.borderMetrics().top,left:c.left+a.paddingMetrics().left+a.borderMetrics().left,width:b.width(),height:b.height()};d.right=d.left+d.width,d.bottom=d.top+d.height;return d},outerRect:function(){var a=this,b=this.$(),c={left:parseFloat(b.css("left"),10),top:parseFloat(b.css("top"),10)},d={top:c.top,left:c.left,width:b.outerWidth(),height:b.outerHeight()};d.right=d.left+d.width,d.bottom=d.top+d.height;return d},anchorTo:function(otherView,anchoring){var self=this;self.anchoring()&&self.deanchor(),self._anchoring=anchoring,extend(anchoring).withObject({otherView:otherView,anchorToOuterRect:!self.ancestors().contains(otherView),anchorOuterRect:!0}),self._anchoringResizeHandler=function(otherView,otherViewRect,otherViewOuterRect){function handleSize(dimension){switch(typeof anchoring[dimension]){case"undefined":break;case"boolean":anchoring[dimension]&&(boundRect[dimension]=anchorToRect[dimension]);break;case"number":boundRect[dimension]=anchorToRect[dimension]*anchoring[dimension];break;case"function":boundRect[dimension]=anchoring[dimension](otherView,otherViewRect,otherViewOuterRect);break;case"string":var expr=anchoring[dimension];if(expr.match(/^[\+-]\d+$/)){boundRect[dimension]=eval(anchorToRect[dimension]+expr);break};default:throw new Error("Invalid anchoring for "+dimension+": "+anchoring[dimension])}}var anchoring=self._anchoring,anchorToRect=anchoring.anchorToOuterRect?otherViewOuterRect:otherViewRect,boundRect=anchoring.anchorOuterRect?self.outerRect():self.rect(),resize=anchoring.anchorOuterRect?self.outerResize:self.resize;handleSize("width"),handleSize("height"),resize.call(self,boundRect)},self._anchoringMoveHandler=function(otherView,otherViewRect,otherViewOuterRect){function handlePosition(position,dimension,opposite){switch(typeof anchoring[position]){case"undefined":break;case"boolean":anchoring[position]&&(boundRect[position]=anchorToRect[position]);break;case"number":boundRect[position]=anchorToRect[dimension]*anchoring[position];break;case"string":var expr=anchoring[position];if(expr.match(/^[\+-]\d+$/)){boundRect[position]=eval(anchorToRect[position]+expr);break}var stringHandled=!0;switch(anchoring[position]){case position:boundRect[position]=anchorToRect[position];break;case opposite:boundRect[position]=anchorToRect[opposite];break;default:stringHandled=!1}if(stringHandled)break;case"function":boundRect[position]=anchoring[position](otherView,otherViewRect,otherViewOuterRect);break;default:throw new Error("Invalid anchoring for "+position+": "+anchoring[position])}}var anchoring=self._anchoring,anchorToRect=anchoring.anchorToOuterRect?otherViewOuterRect:otherViewRect,moveTo=anchoring.anchorOuterRect?self.outerMoveTo:self.moveTo,boundRect={};handlePosition("top","height","bottom"),handlePosition("bottom","height","top"),handlePosition("left","width","right"),handlePosition("right","width","left");if(typeof boundRect.top=="number"&&typeof boundRect.bottom=="number"){var halfHeight=(anchoring.anchorOuterRect?self.outerRect:self.rect).call(self).height/2;boundRect.top=boundRect.top+(boundRect.bottom-boundRect.top)/2-halfHeight,delete boundRect.bottom}if(typeof boundRect.left=="number"&&typeof boundRect.right=="number"){var halfWidth=(anchoring.anchorOuterRect?self.outerRect:self.rect).call(self).width/2;boundRect.left=boundRect.left+(boundRect.right-boundRect.left)/2-halfWidth,delete boundRect.right}moveTo.call(self,boundRect)},self._anchoringSelfResizeHandler=function(a,b,c){self._anchoringMoveHandler(otherView,otherView.rect(),otherView.outerRect())},otherView.onResized(self._anchoringResizeHandler),otherView.onResized(self._anchoringMoveHandler),self.onResized(self._anchoringSelfResizeHandler),otherView.onMoved(self._anchoringResizeHandler),otherView.onMoved(self._anchoringMoveHandler),otherView.onRemoved(function(){self.deanchor()}),self._anchoringResizeHandler(otherView,otherView.rect(),otherView.outerRect()),self._anchoringMoveHandler(otherView,otherView.rect(),otherView.outerRect());return this},anchorToParent:function(a){return this.isRoot()?this:this.anchorTo(this.parent(),a)},anchoring:function(){return this._anchoring},deanchor:function(){var a=this,b=this.anchoring();a.onResized().unbind(a._anchoringSelfResizeHandler),delete a._anchoringSelfResizeHandler,b&&(b.otherView.onResized().unbind(a._anchoringMoveHandler),b.otherView.onResized().unbind(a._anchoringResizeHandler),b.otherView.onMoved().unbind(a._anchoringMoveHandler),b.otherView.onMoved().unbind(a._anchoringResizeHandler),delete a._anchoringResizeHandler,delete a._anchoringMoveHandler,this._anchoring=null);return this},initialize:function(){var a=this.subviews(!0);a.unshift(this),a.forEach(function(a){a.anchor(),a.populate()});return this},render:function(){return this},anchor:function(){return this},populate:function(){return this},update:function(){return this.populate()},draggable:function(){function e(b){var c=a.outerRect(),e=b.pageX-d.pageX,f=b.pageY-d.pageY;a.moveTo({top:c.top+f,left:c.left+e}),d=b}var a=this,b=this.$(),c=z.window();a.onMoved().throttle(5);var d=null;b.bind("mousedown",function(a){d=a,c.bind("mousemove",e),c.one("mouseup",function(){c.unbind("mousemove",e)})})}},Superview.vidSpool=1})(jQuery)
;
;
Superview.Page=function(){var a=function(){extend(this).mixin(Superview)};a.prototype={initialize:function(){Superview.Window.install(),this.$().addClass("page"),this.addTo(Superview.Window),this.render(),this.parent().initialize();return this},fitWindow:function(){return this.anchorTo(Superview.Window,{width:!0,height:!0})}};return a}()
;
;
(function(){Superview.Rect={hasHeight:function(a){return a&&typeof a.height=="number"},hasWidth:function(a){return a&&typeof a.width=="number"},hasTop:function(a){return a&&typeof a.top=="number"},hasLeft:function(a){return a&&typeof a.left=="number"},hasBottom:function(a){return a&&typeof a.bottom=="number"},hasRight:function(a){return a&&typeof a.right=="number"},samePosition:function(){var a=arguments,b=a[0];for(var c=1;c<a.length;c++){var d=a[c];if(d.top!==b.top&&d.left!==b.left)return!1}return!0},sameSize:function(){var a=arguments,b=a[0];for(var c=1;c<a.length;c++){var d=a[c];if(d.width!==b.width&&d.height!==b.height)return!1}return!0},areEqual:function(){var a=arguments,b=a[0];for(var c=1;c<a.length;c++){var d=a[c];if(d.top!==b.top&&d.left!==b.left&&d.width!==b.width&&d.height!==b.height)return!1}return!0}}})()
;
;
Superview.Window=function(){function b(){var b=z.window(),c=z.body();c.width(b.width()),c.height(b.height()),a.outerResize({width:b.width(),height:b.height()})}var a=(new Superview).render();override(a).withObject({addTo:function(a){throw new Error("cannot set the parent of the window")},remove:function(a){throw new Error("cannot remove the window")}}),extend(a).withObject({install:function(){var c=z.body(),d=z.window();c.addClass("superview").css({margin:0,padding:0,width:"100%",height:"100%",overflow:"hidden"}),a.$().addClass("window").appendTo(c),b(),d.resize(b)},_uninstall:function(){z.body().removeClass("superview").css({margin:0,padding:0,width:"100%",height:"100%",overflow:"scroll"}),a.$().detach(),z.window().unbind("resize",b)}});return a}()
;
