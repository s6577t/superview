;
var KeyCodes={Escape:27,Return:13}
;
;
(function($){Superview=function(){eventify(this).define("onResized","onMoved","onSubviewAdded","onSubviewRemoved","onAdded","onRemoved"),this.onResized().throttle(50),this.onMoved().throttle(50),extend(this).with({hasViewMixin:!0,_controller:null,_parent:null,_binding:null,_subviews:{},_vid:Superview.vidSpool++,_zElem:z.div().css({overflow:"hidden",display:"inline-block",position:"absolute",left:0,top:0})})},Superview.prototype={setController:function(a){this._controller=a;return this},getController:function(){return this._controller},vid:function(){return this._vid},elem:function(){return this._zElem.elem()},z:function(){return this._zElem},add:function(){var a=$.isArray(arguments[0])?arguments[0]:Array.toArray(arguments),b=this;a.forEach(function(a){b.z().append(a.elem()),b._subviews[a.vid()]=a,a._parent=b,b.onSubviewAdded().emit(a,b),a.onAdded().emit(a,b)});return this},addTo:function(a){if(!a||this._parent)return this.remove();a.add(this);return this},parent:function(){return this._parent},ancestors:function(){var a=[],b=this.parent();while(b)a.push(b),b=b.parent();return a},isRoot:function(){return!this.parent()},root:function(){var a=this;while(!a.isRoot())a=a.parent();return a},remove:function(){var a=this,b=null,c=!1;arguments.length>0&&(jQuery.isArray(arguments[0])?(b=arguments[0],c=!0):b=Array.toArray(arguments));if(c||b&&b.length>0){b.forEach(function(a){a.remove()});return a}this.z().remove();var d=this._parent;this._parent=null,this.onRemoved().emit(this,d||null),d&&(delete d._subviews[this.vid()],d.onSubviewRemoved().emit(this,d)),this.removeAll(),deventify(this);return this},removeAll:function(){return this.remove(this.subviews())},subviews:function(a){var b=Object.values(this._subviews);a&&b.copy().forEach(function(c){b=b.concat(c.subviews(a))});return b},borderMetrics:function(){var a=this,b=this.z(),c={top:parseFloat(b.css("borderTopWidth"))||0,right:parseFloat(b.css("borderRightWidth"))||0,bottom:parseFloat(b.css("borderBottomWidth"))||0,left:parseFloat(b.css("borderLeftWidth"))||0};c.width=c.right+c.left,c.height=c.top+c.bottom;return c},paddingMetrics:function(){var a=this,b=this.z(),c={top:parseFloat(b.css("paddingTop"))||0,right:parseFloat(b.css("paddingRight"))||0,bottom:parseFloat(b.css("paddingBottom"))||0,left:parseFloat(b.css("paddingLeft"))||0};c.width=c.right+c.left,c.height=c.top+c.bottom;return c},resize:function(a){var b=!1,c=this.z(),d=this.rect();Superview.Rect.hasWidth(a)&&a.width!=d.width&&(b=!0,d.width=a.width,c.css("width",d.width)),Superview.Rect.hasHeight(a)&&a.height!=d.height&&(b=!0,d.height=a.height,c.css("height",d.height)),b&&this.onResized().emit(this,this.rect(),this.outerRect());return this},outerResize:function(a){var b=this.z();Superview.Rect.hasWidth(a)&&(a.width=a.width-(this.paddingMetrics().width+this.borderMetrics().width)),Superview.Rect.hasHeight(a)&&(a.height=a.height-(this.paddingMetrics().height+this.borderMetrics().height));return this.resize(a)},moveTo:function(a){var b=!1,c=this.z(),d=this.rect(),e=this.paddingMetrics(),f=this.borderMetrics();!Superview.Rect.hasTop(a)&&Superview.Rect.hasBottom(a)&&(a.top=a.bottom-d.height),!Superview.Rect.hasLeft(a)&&Superview.Rect.hasRight(a)&&(a.left=a.right-d.width),Superview.Rect.hasTop(a)&&a.top!=d.top&&(b=!0,d.top=a.top-e.top-f.top,c.css("top",d.top)),typeof a.left=="number"&&a.left!=d.left&&(b=!0,d.left=a.left-e.left-f.left,c.css("left",d.left)),b&&this.onMoved().emit(this,this.rect(),this.outerRect());return this},outerMoveTo:function(a){var b=this.z(),c=this.paddingMetrics(),d=this.borderMetrics();Superview.Rect.hasTop(a)&&(a.top+=c.top+d.top),Superview.Rect.hasBottom(a)&&(a.bottom-=c.bottom+d.bottom),Superview.Rect.hasLeft(a)&&(a.left+=c.left+d.left),Superview.Rect.hasRight(a)&&(a.right-=c.right+d.right);return this.moveTo(a)},rect:function(){var a=this,b=this.z(),c={left:parseFloat(b.css("left")),top:parseFloat(b.css("top"))},d={top:c.top+a.paddingMetrics().top+a.borderMetrics().top,left:c.left+a.paddingMetrics().left+a.borderMetrics().left,width:b.width(),height:b.height()};d.right=d.left+d.width,d.bottom=d.top+d.height;return d},outerRect:function(){var a=this,b=this.z(),c={left:parseFloat(b.css("left")),top:parseFloat(b.css("top"))},d={top:c.top,left:c.left,width:b.outerWidth(),height:b.outerHeight()};d.right=d.left+d.width,d.bottom=d.top+d.height;return d},bindTo:function(otherView,binding){var self=this;self.binding()&&self.unbind(),self._binding=binding,extend(binding).with({otherView:otherView,bindToOuterRect:!self.ancestors().contains(otherView),bindOuterRect:!0}),self._bindingResizeHandler=function(otherView,otherViewRect,otherViewOuterRect){function handleSize(dimension){switch(typeof binding[dimension]){case"undefined":break;case"boolean":binding[dimension]&&(boundRect[dimension]=bindToRect[dimension]);break;case"number":boundRect[dimension]=bindToRect[dimension]*binding[dimension];break;case"function":boundRect[dimension]=binding[dimension](otherView,otherViewRect,otherViewOuterRect);break;case"string":var expr=binding[dimension];if(expr.match(/^[\+-]\d+$/)){boundRect[dimension]=eval(bindToRect[dimension]+expr);break};default:throw new Error("Invalid binding for "+dimension+": "+binding[dimension])}}var binding=self._binding,bindToRect=binding.bindToOuterRect?otherViewOuterRect:otherViewRect,boundRect=binding.bindOuterRect?self.outerRect():self.rect(),resize=binding.bindOuterRect?self.outerResize:self.resize;handleSize("width"),handleSize("height"),resize.call(self,boundRect)},self._bindingMoveHandler=function(otherView,otherViewRect,otherViewOuterRect){function handlePosition(position,dimension,opposite){switch(typeof binding[position]){case"undefined":break;case"boolean":binding[position]&&(boundRect[position]=bindToRect[position]);break;case"number":boundRect[position]=bindToRect[dimension]*binding[position];break;case"string":var expr=binding[position];if(expr.match(/^[\+-]\d+$/)){boundRect[position]=eval(bindToRect[position]+expr);break}var stringHandled=!0;switch(binding[position]){case position:boundRect[position]=bindToRect[position];break;case opposite:boundRect[position]=bindToRect[opposite];break;default:stringHandled=!1}if(stringHandled)break;case"function":boundRect[position]=binding[position](otherView,otherViewRect,otherViewOuterRect);break;default:throw new Error("Invalid binding for "+position+": "+binding[position])}}var binding=self._binding,bindToRect=binding.bindToOuterRect?otherViewOuterRect:otherViewRect,moveTo=binding.bindOuterRect?self.outerMoveTo:self.moveTo,boundRect={};handlePosition("top","height","bottom"),handlePosition("bottom","height","top"),handlePosition("left","width","right"),handlePosition("right","width","left");if(typeof boundRect.top=="number"&&typeof boundRect.bottom=="number"){var halfHeight=(binding.bindOuterRect?self.outerRect:self.rect).call(self).height/2;boundRect.top=boundRect.top+(boundRect.bottom-boundRect.top)/2-halfHeight,delete boundRect.bottom}if(typeof boundRect.left=="number"&&typeof boundRect.right=="number"){var halfWidth=(binding.bindOuterRect?self.outerRect:self.rect).call(self).width/2;boundRect.left=boundRect.left+(boundRect.right-boundRect.left)/2-halfWidth,delete boundRect.right}moveTo.call(self,boundRect)},otherView.onResized(self._bindingResizeHandler),otherView.onResized(self._bindingMoveHandler),otherView.onMoved(self._bindingResizeHandler),otherView.onMoved(self._bindingMoveHandler),otherView.onRemoved(function(){self.unbind()}),self._bindingResizeHandler(otherView,otherView.rect(),otherView.outerRect()),self._bindingMoveHandler(otherView,otherView.rect(),otherView.outerRect());return this},bindToParent:function(a){return this.isRoot()?this:this.bindTo(this.parent(),a)},binding:function(){return this._binding},unbind:function(){var a=this,b=this.binding();b&&(b.otherView.onResized().unbind(a._bindingMoveHandler),b.otherView.onResized().unbind(a._bindingResizeHandler),b.otherView.onMoved().unbind(a._bindingMoveHandler),b.otherView.onMoved().unbind(a._bindingResizeHandler),this._binding=null);return this},initialize:function(){var a=this.subviews(!0);a.unshift(this),a.forEach(function(a){a.bind(),a.populate()});return this},render:function(){return this},bind:function(){return this},populate:function(){return this},update:function(){return this.populate()},draggable:function(){function e(b){var c=a.outerRect(),e=b.pageX-d.pageX,f=b.pageY-d.pageY;a.moveTo({top:c.top+f,left:c.left+e}),d=b}var a=this,b=this.z(),c=z.window();a.onMoved().throttle(5);var d=null;b.bind("mousedown",function(a){d=a,c.bind("mousemove",e),c.one("mouseup",function(){c.unbind("mousemove",e)})})}},Superview.vidSpool=1})(jQuery)
;
;
Superview.Page=function(){var a=function(){extend(this).mixin(Superview)};a.prototype={initialize:function(){Superview.Window.install(),this.z().addClass("page"),this.addTo(Superview.Window),this.render(),this.parent().initialize();return this},fitWindow:function(){return this.bindTo(Superview.Window,{width:!0,height:!0})}};return a}()
;
;
(function(){Superview.Rect={hasHeight:function(a){return a&&typeof a.height=="number"},hasWidth:function(a){return a&&typeof a.width=="number"},hasTop:function(a){return a&&typeof a.top=="number"},hasLeft:function(a){return a&&typeof a.left=="number"},hasBottom:function(a){return a&&typeof a.bottom=="number"},hasRight:function(a){return a&&typeof a.right=="number"},samePosition:function(){var a=arguments,b=a[0];for(var c=1;c<a.length;c++){var d=a[c];if(d.top!==b.top&&d.left!==b.left)return!1}return!0},sameSize:function(){var a=arguments,b=a[0];for(var c=1;c<a.length;c++){var d=a[c];if(d.width!==b.width&&d.height!==b.height)return!1}return!0},areEqual:function(){var a=arguments,b=a[0];for(var c=1;c<a.length;c++){var d=a[c];if(d.top!==b.top&&d.left!==b.left&&d.width!==b.width&&d.height!==b.height)return!1}return!0}}})()
;
;
Superview.Window=function(){function b(){var b=z.window(),c=z.body();c.width(b.width()),c.height(b.height()),a.outerResize({width:b.width(),height:b.height()})}var a=(new Superview).render();override(a).with({addTo:function(a){throw new Error("cannot set the parent of the window")},remove:function(a){throw new Error("cannot remove the window")}}),extend(a).with({install:function(){var c=z.body(),d=z.window();c.addClass("superview").css({margin:0,padding:0,width:"100%",height:"100%",overflow:"hidden"}),a.z().addClass("window").appendTo(c),b(),d.resize(b)},_uninstall:function(){z.body().removeClass("superview").css({margin:0,padding:0,width:"100%",height:"100%",overflow:"scroll"}),a.z().detach(),z.window().unbind("resize",b)}});return a}()
;
